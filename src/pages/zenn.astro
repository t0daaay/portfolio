---
import BaseLayout from "../layouts/BaseLayout.astro";
import HorizontalCard from "../components/HorizontalCard.astro";
import { XMLParser } from "fast-xml-parser";
import dayjs from "dayjs";

const RSS_URL = "https://zenn.dev/t0daaay/feed";

const fetchRSS = async (url) => {
  const res = await fetch(url);
  const text = await res.text();

  const parser = new XMLParser({
    ignoreAttributes: false,
    attributeNamePrefix: "@_",
  });

  const json = parser.parse(text);
  return json.rss.channel.item.map((item) => ({
    title: item.title || "",
    desc: dayjs(item.pubDate).format("YYYY-MM-DD") || "",
    img: item.enclosure?.["@_url"] || "",
    url: item.link || "",
  }));
};

const articles = await fetchRSS(RSS_URL);
---

<BaseLayout title="Zenn" sideBarActiveItemID="services">
  <div>
    <div class="text-3xl w-full font-bold mb-5">Zenn</div>
  </div>
  {
    articles.map((article) => (
      <HorizontalCard
        title={article.title}
        desc={article.desc}
        img={article.img}
        url={article.url}
      />
      <div class="divider my-0"></div>
    ))
  }
</BaseLayout>
